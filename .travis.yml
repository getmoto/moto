language: python
sudo: false
services:
  - docker
python:
#  - 2.7
  - 3.6
env:
#    - TEST_SERVER_MODE=false
    - TEST_SERVER_MODE=true
before_install:
  - export BOTO_CONFIG=/dev/null
install:
  - ./travis_install.sh
  - travis_retry pip install coveralls==1.1
    if [ "$TEST_SERVER_MODE" = "true" ]; then
      docker run --rm -t --name moto_server -e AWS_SECRET_ACCESS_KEY=server_secret -e AWS_ACCESS_KEY_ID=server_key -v `pwd`:/moto python:3.6.2-stretch /moto/travis_moto_server.sh &
      sleep 30  # wait for server to come up
      export AWS_SECRET_ACCESS_KEY=foobar_secret
      export AWS_ACCESS_KEY_ID=foobar_key
    fi
script:
  - make test
after_success:
  - coveralls
